# Part 1 전술적 설계

- 전술적 설계 관점으로 본 DDD는 '어떻게?'라는 방법에 대한 것이다. 즉, 소프트웨어 각각의 구성요소가 구현되는 방법을 찾는 것이다.

### 05 _ 간단한 비즈니스 로직 구현

---

**비즈니스 로직은 소프트웨어에서 가장 중요한 부분이며 애초에 소프트웨어를 구현하는 이유이기도 하다.**



#### 트랜잭션 스크립트

---

> **"프레젠테이션으로부터 단일 요청을 처리하는 여러 프로시저를 모아서 비즈니스 로직을 구현하라." **
>
> **- 마틴파울러(Martin Fowler)**

시스템의 퍼블릭 인터페이스는 사용자가 실행할 수 있는 비즈니스 트랜잭션의 모음으로 볼 수 있다.

![image-20220812071724853](C:\Users\glay415as\AppData\Roaming\Typora\typora-user-images\image-20220812071724853.png)

이러한 트랜잭션은 시스템에서 관리하는 정보를 검색, 수정 또는 둘 다 할 수 있다.

트랜잭션 스크립트 패턴은 프로시저를 기반으로 시스템의 비즈니스 로직을 구성하며, 각 프로시저는 퍼블릭 인터페이스를 통해 시스템 사용자가 실행하는 작업을 구현한다.

##### 구현

각 프로시저는 간단하고 쉬운 절차지향 스크립트로 구현하며 구현해야 하는 유일한 요구사항은 트랜잭션 동작이다.

저장 장치와 연동하기 위해 얇은 추상화 계층을 사용할 수 있지만 데이터베이스에 직접 접근도 가능하다.

트랜잭션 동작은 성공하거나 실패할 수 있지만, 유효하지 않은 상태를 만들면 안 되며 일관성을 유지해야 한다.

##### 분산 트랜잭션

최신 분산 시스템에서는 데이터베이스의 데이터를 변경한 다음 메시지 버스에 메시지를 발행하여 시스템의 다른 컴포넌트에 변경사항을 알리는 것이 일반적이다.

##### 암시적 분산 트랜잭션

트랜잭션 동작을 보장하는 방법은 다음과 같다.

- 작업을 멱등성 있게 만들어 같은 요청을 여러번 반복해도 결과는 동일하게 만드는 방법
- 낙관적 동시성 제어를 사용하는 방법

##### 트랜잭션 스크립트를 사용하는 경우

트랜잭션 스크립트 패턴은 비즈니스 로직이 단순한 절차적 작업처럼 매우 간단한 문제 도메인에 효과 적이다.

트랜잭션 스크립트 패턴은 정의상 지원 하위 도메인에 적합하다. 또한 일반 하위 도메인과 같은 외부 시스템과 연동하기 위한 어댑터로 사용하거나 충돌 방지 계층의 일부로 사용할 수도 있다.

트랜잭션 스크립트 패턴의 주요 장단점은 **단순함**이다.

- 장점은 비즈니스 로직을 이해하기 위한 시간이 최소화된다는 점이다.
- 단점은 비즈니스 로직이 복잡할수록 트랜잭션 간의 비즈니스 로직이 중복되기 쉽고 일관성 없는 동작이 발생할 수 있다.

결과적으로 핵심 하위 도메인에는 트랜잭션 스크립트를 사영하면 안된다.



#### 액티브 레코드

---

> **"데이터베이스 테이블 또는 뷰의 행을 감싸고 데이터베이스 접근을 캡슐화하고 해당 데이터에 도메인 로직을 추가하는 오브젝트"**
>
> **- 마틴 파울러**

트랜잭션 스크립트 패턴과 마찬가지로 액티브 레코드는 비즈니스 로직이 단순할 경우 사용한다. 하지만 좀 더 복잡한 자료구조에서도 비즈니스 로직이 작동할 수 있다.

예를 들어 더 복잡한 오브젝트 트리와 계층 구조를 가질 수 있다.

![image-20220812073729317](C:\Users\glay415as\AppData\Roaming\Typora\typora-user-images\image-20220812073729317.png)

##### 구현

이 패턴은 액티브 레코드라는 전용 객체를 사용하여 복잡한 자료구조를 표현하며 CRUD 작업도 구현한다.

액티브 레코드 객체는 ORM 또는 다른 데이터 접근 프레임워크와도 관련이 있다. 즉 액티브 레코드는 데이터 접근 로직을 구현한다.

##### 액티브 레코드를 사용하는 경우

액티브 레코드는 본질적으로 데이터베이스 접근을 최적화하는 트랜잭션 스크립트이기 때문에 이 패턴은 CRUD 작업과 같은 비교적 간단한 비즈니스 로직만 지원할 수 있다.

트랜잭션 스크립트 패턴과 마찬가지로 액티브 레코드 패턴은 지원 하위 도메인, 일반 하위 도메인과 외부 솔루션의 연동, 모델 변환 작업에 적합하다.

액티브 레코드 패턴은 빈약한 도메인 모델 패턴(anemic domain model pattern)이라고도 하며, 다시 말하면 부적절하게 설계된 도메인 모델이다.



#### 실용적인 접근 방식

----

**비즈니스 데이터가 중요하고 설계 및 개발되는 코드의 무결성도 보호해야 하지만 실용적인 접근 방식이 더 바람직한 몇 가지 경우가 있다.**

항상 그렇듯 보편적 법칙은 없다. 그것은 작업 중인 비즈니스 도메인에 달려 있다. 매일 수십억 개의 이벤트를 수집하는 시스템에서 이벤트의 0.001%가 중복되거나 손실되는 일은 가능하면 무시해도 좋다. 다만 위험과 비즈니스 영향을 평가해야한다.



#### 결론

---

**트랜잭션 스크립트** - 이 패턴은 시스템 작업을 간단하고 쉬운 절차지향 스크립트로 구성한다. 이 절차는 작업에 트랜잭션을 적용해서 작업이 성공하거나 실패하도록 보장한다. 트랜잭션 스크립트 패턴은 단순한 비즈니스 로직을 가진 지원 하위 도메인에 적합하다. 

**액티브 레코드** - 비즈니스 로직이 단순하지만 복잡한 자료구조에서 작동하는 경우 해당 자료구조를 액티브 레코드로 구현할 수 있다. 액티브 레코드 객체는 간단한 CRUD 데이터 접근 방법을 제공하는 자료구조다.



#### 느낀점

---

- 트랜잭션에 대해 자세히 알지못해 조금 해멧지만 결국엔 당연한 소리임을 알게되었다.