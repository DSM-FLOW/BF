### 03 _ 도메인 복잡성 관리

---

조직 규모에 따라 도메인 전문가의 멘탈 모델은 일관성이 없을 수 있다. 같은 비즈니스 도메인에서도 도메인 전문가마다 서로 다른 모델을 사용할 수 있다.

#### 일관성 없는 모델

---

**다양한 비즈니스 도메인 모델을 소프트웨어로 표현하는 것은 어렵다. 소스코드는 모호성에 잘 대처하지 못한다.**

여기에 텔레마케팅 회사가 있다고 쳐보자.

- 회사의 마케팅 부서는 온라인 광고를 통해 리드(lead)를 생성한다. 

- 영업 부서는 잠재고객이 제품이나 서비스를 구매하도록 유도하는 역할을 한다.

![image](https://user-images.githubusercontent.com/80652992/183734720-4c83180c-2d1e-45e9-bc24-75dc39b7016f.png)

해당 회사의 도메인 전문가의 언어를 살펴보면 특이한 점이 있다. **리드(lead)**라는 용어가 마케팅과 영업 부서에서 서로 다른 의미로 사용된다.

**마케팅 부서** - 마케팅 담당자에게 리드는 누군가가 제품 중 하나에 관심이 있다는 알림을 나타낸다. 잠재고객의 연락처 정보를 수신하는 이벤트는 리드로 간주된다.

**영업 부서** - 영업 부서 컨텍스트에서 리드는 훨씬 더 복잡하다. 리드는 영업 프로세스의 전체 수명주기를 나타낸다. 리드는 단순한 이벤트가 아니라 장기적으로 진행되는 과정이다.

*이 경우 각 부서의 '리드' 멘탈 모델은 차이가 있다.*

영업 부서는 복잡한 모델을, 마케팅 부서는 간단한 모델을 가지고 있다. 이런 비즈니스 도메인 모델을 소프트웨어로 표현하려면 다음과 같은 딜레마가 있다.

- 영업 부서의 모델을 마케팅 부서에 적용하면 과도한 솔루션(over-engineered)를 초래하고
- 마케팅 관점에 따라 영업 모델을 단순화하면 엔지니어링이 조금 더 필요한 솔루션(under-engineered)를 초래한다.



위 같은 문제에 대한 전통적인 솔루션은 모든 종류의 문제에 사용할 수 있는 단일 모델을 설계하는 것이다.

이러한 모델은 전체 사무실 벽에 걸쳐 있는 거대한 ERD를 생성한다.

![image](https://user-images.githubusercontent.com/80652992/183734873-64415c37-5135-462b-b89a-ce25124be83b.png)

> '이것저것 다 잘하는 사람은 단 한 분야에서도 달인이 될 수 없다(Jack of all trades, master of none)'

이러한 모델은 모든 것에 적합해야 하지만 결국에는 아무 수용이 없다. 무엇을 하든 복잡성에 직면하게 될 것이다.



또 다른 솔루션은 '마케팅 리드', '영업 리드'와 같이 문맥상 정의에 문제가 있는 용어 앞에 접두사를 추가하는 것이다.

하지만 이 방법은 다음과 같은 단점을 유발한다.

- 인지부하를 유발한다.
- 모델의 구현이 유비쿼터스 언어와 일치하지 않는다.



#### 바운디드 컨텍스트

---

**도메인 주도 설계에서 솔루션은 간단하다. 유비쿼터스 언어를 여러 개의 작은 언어로 나눈 다음 각 언어를 적용할 수 있는 명시적인 바운디드 컨텍스트(bounded context) 에 할당하면 된다.**

![image](https://user-images.githubusercontent.com/80652992/183739692-66ee5da5-abf8-48a3-bfed-a08c1e9a443a.png)

각 바운디드 컨텍스트에서 단일 의미를 갖는 한, 세분화된 유비쿼터스 언어 각각은 일관성을 띠며 도메인 전문가의 멘탈 모델을 따를 수 있다.

바운디드 컨텍스트 패턴을 사용하면 컨텍스트를 명시적이고 중요한 비즈니스 도메인의 요소로 모델링할 수 있다.



##### 모델 경계

모델은 경계 없이 존재할 수 없다. 경계가 없다면 현실 세계의 복제본처럼 확장 될 것이다. 따라서 모델의 경계를 정의하는 것은 모델링 프로세스의 본질적인 부분이다.

바운디드 컨텍스트는 유비쿼터스 언어와 해당 언어가 나타내는 모델의 적용 가능성을 규정한다.

바운디드 컨텍스트는 유비쿼터스 언어의 일관성이 유지되는 경계다.

##### 정제된 유비쿼터스 언어

유비쿼터스 언어는 바운디드 컨텍스트에 포함된 모델을 설명하는 데만 집중한다.

모델은 우리가 해결해야 하는 문제 없이는 존재할 수 없기에 유비쿼터스 언어는 명시적으로 적용 가능한 컨텍스트 없이 정의하거나 사용할 수 없다.

##### 바운디드 컨텍스트의 범위

비즈니스 도메인을 모델리아힉 위해 우리는 모델을 분할하고, 각 세분화된 모델에 적용 가능한 컨텍스트를 엄격하게 정의해야 했다.

유비쿼터스 언어의 일관성은 해당 언어의 가장 넓은 경계를 식별하는데 도움이 될 뿐이다.

![image](https://user-images.githubusercontent.com/80652992/183743463-82fce39b-87e3-42b1-bcf1-907b117cff49.png)

바운디드 컨텍스를 정의하는 것은 전략적인 설계 의사결정이다.

경계는 비즈니스 도메인의 고유한 컨텍스트에 따라 넓힐 수 있고, 비즈니스 도메인을 더 작은 문제 도메인으로 세분화하여 좁힐 수 있다.

모델 크기의 정답은 없다. 다만 모델 자체로 유용해야 한다.

큰 유비쿼터스 언어를 더 작고 관리하기 쉬운 문제 도메인으로 나누는 것은 도움이 될 수 있지만, 바운디드 컨텍스트를 작게 만들기 위해 노력하는 것은 설계를 통합하는 오버헤드가 커진다는 문제점을 만들 수 있다.

따라서 바운디드 컨텍스트의 크기는 문제 도메인이 무엇이냐에 따라 달라진다.



비효율 적인 분배를 피하기 위해선 하위 도메인을 찾아, 같은 데이터에서 작동하는 응집된 유스케이스의 집합을 식별하되, 그것을 어려개의 바운디드 컨텍스트로 분해하지 않는 것이다.

#### 바운디드 컨텍스트 vs 하위 도메인

---

##### 하위도메인

도메인 주도 설계 방법론에 따르면 분석 단계에는 다양한 하위 도메인을 식별하는 작업이 포함된다.

하위 도메인은 비즈니스 도메인과 시스템 요구사항에 따라 정의되는 상호 관련된 유스케이스 집합과 유사하다.

소프트웨어 엔지니어는 요구사항을 정의하지 않는다. 대신 하위 도메인을 식별하기 위해 비즈니스 도메인을 분석한다.

##### 바운디드 컨텍스트

바운디드 컨텍스트는 소프트웨어 엔지니어에 의해 설계된다.

모델의 경계를 선택하는 것은 전략적 설계의 의사결정이다.

##### 하위 도메인과 바운디드 컨텍스트 사이의 상호작용

이론적으로는 단일 모델이 전체 비즈니스 도메인에 적용될 수 있다. 이러한 전략은 다음과 같은 소규모 시스템에서 효과적일 수 있다.

![image](https://user-images.githubusercontent.com/80652992/183750014-9257451e-5f08-42a4-8966-03c3c19766a0.png)

만약 모델이 충돌하면 다음과 같이 도메인 전문가의 멘탈 모델에 따라 시스템을 바운디드 컨텍스트로 분해할 수 있다.

![image](https://user-images.githubusercontent.com/80652992/183750207-eb9616cb-bc1b-4eef-9fcd-453a07b3e803.png)

모델이 여전히 크고 유지보수 하기 어려운 경우 더 작은 바운디드 컨텍스트로 분해할 수 있다.

![image](https://user-images.githubusercontent.com/80652992/183750345-0ca740bb-f043-48a1-a790-00616290611a.png)

어느 쪽이든 이것은 설계에 대한 의사결정이다. 이러한 경계를 솔루션의 일부로 설계한다.



중요한 것은 하위 도메인은 발견하고 바운디드 컨텍스트는 설계한다는 점이다.

하위 도메인은 비즈니스 전략에 의해 정의된다.

그러나 소프트웨어 엔지니어는 특정 프로젝트의 컨텍스트와 제약 조건을 해결하기 위해 솔루션과 바운디드 컨텍스트를 설계할 수 있다.



#### 경계

---

> '건축 설계는 시스템 설계다. 시스템 설계는 상황에 맞는 설계다. 본질적으로 경계와 균형에 관한 것이다. 내부의 모양을 구성하는 것 처럼 외부의 모양도 재구성한다.' - 루스 말란(Ruth Malan)

바운디드 컨텍스트 패턴은 물리적 경계와 소유권 경계를 규정하기 위한 도메인 주도 설계 도구다.

##### 물리적 경계

각 바운디드 컨텍스트는 개별 서비스/프로젝트로 구현돼야 한다. 즉, 구현, 진화, 버전 관리를 각각의 다른 바운디드 컨텍스트와 독립적으로 해야 한다.

바운디드 컨텍스트 간의 명확한 물리적 경계를 통해 각 바운디드 컨텍스트를 요구사항에 가장 적합한 기술 스택으로 구현할 수 있다.

##### 논리적 경계

바운디드 컨텍스트는 여러 하위 도메인을 포함할 수 있다. 이경우 바운디드 컨텍스트는 물리적 경계고 하위 도메인은 논리적 경계다.

논리적 경계는 프로그래밍 언어의 종류에 따라 네임스페이스나 모듈, 패키지 같은 다른 이름을 갖는다.

##### 소유권 경계

바운디드 컨텍스트는 한 팀에서만 구현, 발전, 유지 관리해야 한다. 두 팀이 같은 바운디드 컨텍스트에서 작업할 수 없다.

이러한 분리는 팀이 서로의 모델에 대해 만들 수 있는 암묵적인 가정을 제거한다. 대신 팀은 서로 다른 바운디드 컨텍스트로 분리된 모델과 시스템으로 명시적으로 연동하기 위한 통신 프로토콜을 정의해야 한다.



#### 실생활의 바운디드 컨텍스트

----

**실제로 바운디드 컨텍스트는 비즈니스 도메인과 하위 도메인만큼 분명하지 않지만, 도메인 전문가의 멘탈 모델이 있는 것처럼 존재한다. 소프트웨어 엔지니어는 도메인 전문가가 다양한 비즈니스 엔티티와 프로세스에 대해 어떻게 생각하는지 의식해야한다.**

소프트웨어에서 비즈니스 도메인을 모델링할 때 바운디드 컨텍스트가 있을 뿐만 아니라 다른 컨텍스트에서 다른 모델을 사용한다는 개념이 일반적으로 널리 퍼져 있다.

##### 시멘틱 도메인(semantic domain)

시멘틱 도메인은 의미 영역과 해당 의미를 전다랗기 위해 사용하는 단어 영ㅇ역으로 구분한다. 예를 들어 모니터, 포트, 프로세서라는 단어는 소프트웨어와 하드웨어 엔지니어링 시맨틱 도메인에서 서로 다른 의미를 갖는다.

- 예를 들어 식물학의 바운디드 컨텍스트에서 토마토는 과일이고 요리의 바운디드 컨텍스트에서는 채소다. 또한 과세라는 바운디드 컨텍스트에서는 토마토는 채소이며 연극 공연의 바운디드 컨텍스트에서 토마토는 피드백 메커니즘이다.

##### 과학

> "과학자들은 일반적으로 어떤 이론도 100% 정확하지 않다는 데 동의한다. 그러므로 진정한 시험은 진리가 아니라 효용이다." - 유발 노아 하라리(Yuval Noah Harari)

모든 경우 맞는 과학적 이론은 없다. 다른 이론은 다른 맥락 안에서 유용하다.

뉴턴의 운동 법칙에 따르면 공간과 시간은 절대적이다. 하지만 아인슈타인의 상대성 이론에서 공간과 시간은 절대적이지 않으며 관찰자에 따라 다르다.

이 두 모델이 모순되는 것처럼 보일 수 있지만 둘 다 적절한 컨텍스트에서 유용할 뿐이다.

##### 냉장고 구입

냉장고 넓이의 골판지를 가져다 놓아도 모델이 어떤 문제를 해결하고자 하는 가에 따라 그것은 냉장고 모델이 될 수 있다.

모델은 실제 엔티티를 복사하는 것이 아니기 때문이다.

예를 들어 우리가 해결하려는 문제가 냉장고가 부엌문을 통과할 수 있는지라면 냉장고보다는 냉장고 넓이의 골판지가 더욱 유용한 모델이 될 수 있다.



#### 결론

도메인 전문가의 멘탈 모델에 내재된 충돌을 발견할 때마다 유비쿼터스 언어를 여러 개 바운디드 컨텍스트로 분해해야 한다.

유비쿼터스 언어는 바운디드 컨텍스트 범위 내에서 일관성이 있어야 한다.

하위 도메인이 발견되면 바운디드 컨텍스트도 설계한다. 도메인을 바운디드 컨텍스트로 나누는 것은 전략적 설계의 의사결정이다.

바운디드 컨텍스트와 유비쿼터스 언어는 한 팀에서만 유지보수 할 수 있다.

바운디드 컨텍스트는 시스템을 서비스, 하위 시스템 등의 물리적 구성요소로 분해한다. 바운디드 컨텍스트의 수명주기는 서로 독립적이다.



#### 느낀점

바운디드 컨텍스트를 배우면서 모델을 바라보는 시각을 좀더 고차원적으로 확장시킬 수 있었다.