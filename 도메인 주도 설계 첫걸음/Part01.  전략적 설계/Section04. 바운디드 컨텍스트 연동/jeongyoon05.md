## 바운디드 컨텍스트 연동

바운디드 컨텍스트 패턴은 유비쿼터스 언어의 일관성을 유지할 뿐만 아니라 모델링도 가능하게 한다.

다른 바운디드 컨텍스트의 모델은 서로 독립적으로 발전하고 구현될 수 있다. 그러나 바운디드 컨텍스트 자체는 독립적이지 않다.

서로 독립적으로 발전할 수 있지만, 상호작용 해야한다. 바운디드 컨텍스트 사이에는 항상 접점이 있는데 이것을 컨트랙트라고 부른다.

컨트랙트의 필요성은 바운디드 컨텍스트의 모델과 언어의 차이에서 비롯된다.

<br/>

## 협력형 패턴 그룹

협력형 그룹의 패턴은 소통이 잘 되는 팀에서 구현된 바운디드 컨텍스트와 관련이 있다.

이 패턴이 적합한 요건은 팀의 커뮤니케이션과 협업의 수준에 있다.

<br/>

#### 파트너십 패턴

파트너십 모델에서 바운디드 컨텍스트 간의 연동은 애드혹 방식으로 조정한다.

<br/>

#### 공유 커널 패턴

바운디드 컨텍스트가 모델의 경계임에도 불구하고, 여전히 하위 도메인의 동일 모델 혹은 그 일부가 여러 다른 바운디드 컨텍스트에서 구현되는 경우가 있다.

공유커널과 같은 공유 모델은 모든 바운디드 컨텍스트의 필요에 따라 설계된다.

각 바운디드 컨텍스트는 권한 모델을 수정할 수 있고 이 변경은 모델을 사용하는 다른 모든 바운디드 컨텍스트에 영향을 준다.

<br/>

#### 공유 범위

겹치는 형태의 모델은 해당되는 바운디드 컨텍스트의 수명주기도 서로 엮이게 한다. 공유 모델의 변경은 다른 모든 바운디드 컨텍스트에 즉시 영향을 준다.

공유 커널은 바운디드 컨텍스트 간에 제공될 의도가 있는 연동 관련 컨트랙트와 자료구조만으로 구성하는 것이 이상적이다.

<br/>

#### 구현

공유 커널은 소스코드의 모든 변경이 이를 사용하는 모든 바운디드 컨텍스트에 즉시 반영되도록 구현된다.

공유 커널은 여러 바운디드 컨텍스트에 속하기 때문에 변경은 지속적으로 통합돼야 한다.

바운디드 컨텍스트가 변경 전의 공유 커널 구현을 참조하므로 데이터가 깨지거나 운영 중 문제가 발생할 수 있다.

<br/>

#### 공유 커널을 사용해야 하는 경우

공유 커널 패턴의 적용 여부를 결정하는 가장 중요한 기준은 중복 비용과 조율 비용의 비율이다.

두 바운디드 컨텍스트가 공유하는 코드베이스에 대한 변경을 조율하려는 노력보다 공유하는 모델에 대한 변경을 통합할 때 드는 노력이 더 클 경우에 적용한다.

같은 팀이 공유 커널을 구현하지 않는다면 이는 단일 팀 원칙을 위반하는 것이다.

통합 비용과 중복 비용의 차이는 모델의 변동성에 달렸다.

공유 커널은 동일 팀에서 소유하고 구현한 바운디드 컨텍스트를 연동하는 경우에 잘 맞는다.

바운디드 컨텍스트의 연동 컨트랙트를 명시적으로 정의하는데 공유 커널을 사용할 수 있다.

<br/>

## 사용자-제공자 패턴 그룹

협업 패턴 사용자-제공자 패턴 그룹

서비스 제공자는 '업스트림'이고 고객 또는 사용자는 '다운스트림'이다.

협력 그룹의 경우와는 다르게 양 팀은 서로 독립적으로 성공할 수 있다. 그러나 대부분의 경우 업스트림 또는 다운스트림의 팀이 연동 컨트랙트를 주도하는 권력의 불균형이 존재한다.

<br/>

#### 순응주의자 패턴

> 다운스트림 팀이 업스트림 팀의 모델을 받아들이는 바운디드 컨텍스트의 관계를 순응주의자 패턴이라고 부른다.

<br/>

#### 충돌 방지 계층 패턴

충돌 방지 계층 패턴은 다음 사례와 같이 제공자의 모델을 따르는 것을 원치 않거나 순응에 필요한 노력이 가치가 없을 경우를 다룬다.

충돌 방지 계층을 통해 업스트림 바운디드 컨텍스트의 모델을 스스로의 필요에 맞게 가공할 수 있다.

- ##### 다운스트림 바운디드 컨텍스트가 핵심 하위 도메인을 포함할 경우

​		핵심 하위 도메인은 각별한 주의가 필요하다. 제공자의 모델이 자칫 문제 도메인에 대한 모델링을 방해할 수 있다.

- ##### 업스트림 모델이 사용자의 요건에 비효율적이거나 불편한 경우

​		바운디드 컨텍스트가 혼란에 순응하면 그 자체로 위험에 빠지게 된다. 이런 경우는 레거시 시스템과 연동할 때 종종 발생한다.

- ##### 제공자가 컨트랙트를 자주 변경하는 경우

​		사용자는 잦은 변경으로부터 모델을 보호하기를 원한다. 충돌 방지 계층이 있으면 제공 모델의 변경은 변환 장치에서만 영향을 미친다.

<br/>

#### 오픈 호스트 서비스 패턴

이 패턴은 힘이 사용자 측에 있을 경우를 처리한다. 

구현 모델의 변경으로부터 사용자를 보호하기 위해 업스트림 제공자는 퍼블릭 인터페이스와 구현 모델을 분리한다.

오픈 호스트 서비스 패턴은 충돌 방지 계층 패턴의 반대다.

<br/>

## 분리형 노선

분리형 노선 패턴에는 팀에 협업 의지가 없거나 협업할 수 없는 경우와 같이 다양한 이유가 있다.

<br/>

#### 커뮤니케이션 이슈

협업을 회피하는 일반적인 이유는 조직의 규모와 내부 정치 요인으로 인한 커뮤니케이션의 어려움 때문이다. 

팀이 협업과 합의에 어려움을 겪고 있다면 여러 바운디드 컨텍스트 내에서 기능을 중복해서 가져가고 각자의 길을 가는 것이 더 비용 효과적이다.

<br/>

#### 일반 하위 도메인

일반 하위 도메인이 일반 솔루션과 연동하는 것이 쉽다면 각 바운디드 컨텍스트 내에서 각자 연동하는 것이 더욱 비용 효과적일 수 있다.

<br/>

#### 모델의 차이

모델이 너무 달라서 순응주의자 관계가 불가능하고 충돌 방지 계층을 구현하는 것도 기능 중복보다 비용이 더 클 수 있다. 이런 경우에는 팀이 각자의 길을 가는 것이 더 비용 효과적이다.

<br/>

## 컨텍스트 맵

컨텍스트 맵은 시스템의 바운디드 컨텍스트와의 연동을 시각적으로 표현한다.

- ##### 거시적 설계 관점

​	컨텍스트 맵은 시스템의 구성요소와 구현하는 모델의 개요를 제공한다.

- ##### 커뮤니케이션 패턴

​	컨텍스트 맵은 시스템의 구성요소 간의 커뮤니케이션 패턴을 묘사한다. 예를 들어, 어떤 팀이 협력하고, 충돌방지 계층과 분리형 노선 패	턴과 같은 '덜 친밀한' 연동 패턴을 선호하는지 보여준다.

- ##### 조직적 문제

​	컨텍스트 맵은 조직적 문제에 대한 통찰력을 제공한다. 가령 특정 업스트림 팀의 다운스트림 사용자가 모두 충돌 방지 계층을 구현하는 	데 의존하거나 분리형 노선 패턴의 모든 구현이 한 팀에 집중된다면 이는 무엇을 의미할까?

<br/>

#### 유지보수

컨텍스트 맵은 프로젝트 초기부터 도입해서 새로운 바운디드 컨텍스트와 기존 요소에 대한 수정을 반영하는 것이 이상적이다.

각 팀은 자신이 담당하는 외부 바운디드 컨텍스트 연동에 대해 갱신한다.

컨텍스트 맵은 컨텍스트 매퍼 같은 도구를 사용해서 코드로 관리할 수 있다.

<br/>

#### 한계

컨텍스트 맵을 작성하는 것은 어려운 작업이다. 여러 하위 도메인에 걸친 시스템의 바운디드 컨텍스트에는 작동하는 여러 연동 패턴이 있을 수 있다.

하위 도메인의 모듈이 다른 통합 전략을 필요로 하는 경우 여전히 여러 통합 패턴이 있을 수 있다.

<br/>

## 결론

바운디드 컨텍스트는 서로 상호작용해야 한다.

- ##### 파트너십

​	바운디드 컨텍스트 애드훅 방식으로 연동된다.

- ##### 공유 커널

  두 개 이상의 바운디드 컨텍스트가 참여하는 모든 바운디드 컨텍스트가 공유하는 제한적으로 겹치는 모델을 공유해서 연동한다.

- ##### 순응주의자

  사용자는 서비스 제공자의 모델을 사용자의 요건에 맞게 번역한다.

- ##### 충돌 방지 계층

  사용자는 서비스 제공자의 모델을 사용자의 요건에 맞게 번역한다.

- ##### 오픈 호스트 서비스

  서비스 제공자는 사용자의 요건에 최적화된 모델인 공표된 언어를 구현한다.

- ##### 분리형 노선

  협력과 연동보다 특정 기능을 중복으로 두는 것이 더 저렴한 경우다.

바운디드 컨텍스트 간의 연동은 컨텍스트 맵으로 표현된다. 이를 통해 시스템의 거시적 설계 관점, 커뮤니케이션 패턴, 그리고 조직 문제에 대한 통찰력을 얻을 수 있다.

<br/>

# 느낀점

바운디드 컨텍스트 간의 관계와 연동을 정의하는 패턴에 대해 알게 되었다.